"use strict";var express=require("express"),connectDB=require("./config/db"),dotenv=require("dotenv"),userRoutes=require("./routes/userRoutes"),chatRoutes=require("./routes/chatRoutes"),messageRoutes=require("./routes/messageRoutes"),_require=require("./middleware/errorMiddleware"),notFound=_require.notFound,errorHandler=_require.errorHandler,path=require("path");dotenv.config(),connectDB();var app=express();app.use(express.json()),app.use("/api/user",userRoutes),app.use("/api/chat",chatRoutes),app.use("/api/message",messageRoutes);var __dirname1=path.resolve();"production"===process.env.NODE_ENV?(app.use(express.static(path.join(__dirname1,"/frontend/build"))),app.get("*",function(e,n){return n.sendFile(path.resolve(__dirname1,"frontend","build","index.html"))})):app.get("/",function(e,n){n.send("API is running..")}),app.use(notFound),app.use(errorHandler);var PORT=process.env.PORT,server=app.listen(PORT,console.log("Server running on PORT ".concat(PORT,"...").yellow.bold)),io=require("socket.io")(server,{pingTimeout:6e4,cors:{origin:"http://localhost:3000"}});io.on("connection",function(o){console.log("Connected to socket.io"),o.on("setup",function(e){o.join(e._id),o.emit("connected")}),o.on("join chat",function(e){o.join(e),console.log("User Joined Room: "+e)}),o.on("typing",function(e){return o.in(e).emit("typing")}),o.on("stop typing",function(e){return o.in(e).emit("stop typing")}),o.on("new message",function(n){var e=n.chat;if(!e.users)return console.log("chat.users not defined");e.users.forEach(function(e){e._id!=n.sender._id&&o.in(e._id).emit("message recieved",n)})}),o.off("setup",function(){console.log("USER DISCONNECTED"),o.leave(userData._id)})});
//# sourceMappingURL=server.min.js.map
